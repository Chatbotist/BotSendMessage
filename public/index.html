<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Bot API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        form {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 300px;
            text-align: center;
        }

        .form-control {
            margin: 15px 0; /* Отступ между полями ввода */
        }

        input,
        textarea {
            width: calc(100% - 22px); /* Учитываем отступы в ширине полей ввода */
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box; /* Учитываем отступы при расчете ширины */
        }

        button {
            background: #5cb85c;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        button:hover {
            background: #4cae4c;
        }

        .hidden {
            display: none;
        }

        .message-type {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }

        .form-label {
            text-align: left;
            margin: 10px 0 5px;
        }
    </style>
</head>

<body>
    <form id="sendMessageForm">
        <h1>Отправить рассылку подписчикам Telegram бота</h1>
        <div class="form-control">
            <label class="form-label" for="botToken">Токен бота Telegram:</label><br>
            <input type="text" id="botToken" required>
        </div>
        
        <div class="form-control">
            <label class="form-label" for="telegramIds">Telegram IDs (через запятую):</label><br>
            <input type="text" id="telegramIds" required pattern="[0-9,]*" title="Только цифры и символ запятой">
        </div>
        
        <div class="message-type">
            <label><input type="radio" name="messageType" value="text" checked> Текст</label>
            <label><input type="radio" name="messageType" value="photo"> Фото</label>
        </div>

        <div id="textMessageFields" class="message-fields">
            <div class="form-control">
                <label class="form-label" for="text">Текст сообщения:</label><br>
                <textarea id="text" required></textarea>
            </div>
        </div>

        <div id="photoFields" class="message-fields hidden">
            <div class="form-control">
                <label class="form-label" for="photoUrl">URL фото:</label><br>
                <input type="url" id="photoUrl" required pattern="https?://.+" title="Введите корректный URL, начинающийся с http:// или https://">
            </div>
            <div class="form-control">
                <label class="form-label" for="caption">Подпись к фото (необязательно):</label><br>
                <input type="text" id="caption">
            </div>
        </div>

        <button type="submit">Отправить сообщение</button>
    </form>

    <script>
        const messageTypeRadios = document.querySelectorAll('input[name="messageType"]');
        const textMessageFields = document.getElementById('textMessageFields');
        const photoFields = document.getElementById('photoFields');

        function toggleFields() {
            const selectedType = document.querySelector('input[name="messageType"]:checked').value;

            // Отображаем или скрываем поля в зависимости от выбранного типа сообщения
            if (selectedType === 'text') {
                textMessageFields.classList.remove('hidden');
                photoFields.classList.add('hidden');
            } else if (selectedType === 'photo') {
                textMessageFields.classList.add('hidden');
                photoFields.classList.remove('hidden');
            }
        }

        messageTypeRadios.forEach(radio => {
            radio.addEventListener('change', toggleFields);
        });

        document.getElementById('sendMessageForm').addEventListener('submit', async (event) => {
            event.preventDefault();
            const botToken = document.getElementById('botToken').value;
            const telegramIds = document.getElementById('telegramIds').value.split(',').map(id => id.trim());
            const text = document.getElementById('text').value || null;
            const caption = document.getElementById('caption').value || null;
            const photoUrl = document.getElementById('photoUrl').value || null;
            const messageType = document.querySelector('input[name="messageType"]:checked').value;

            const response = await fetch('/send', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ bot_token: botToken, telegram_ids: telegramIds, text, caption, photo_url: photoUrl, message_type: messageType }),
            });

            const result = await response.json();
            alert(result.message || result.error);
        });

        // Initial setup: show/hide fields based on the default selected message type
        toggleFields();
    </script>
</body>

</html>
